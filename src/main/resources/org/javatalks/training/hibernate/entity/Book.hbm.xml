<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC
    "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
    "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd">
<hibernate-mapping package="org.javatalks.training.hibernate.entity">
  <class name="Book" table="book">
    <id name="id">
      <generator class="native"/>
    </id>
    <property name="title" />

    <list name="comments" cascade="all">
      <key column="book_id" foreign-key="comment_book_id" not-null="true"/>
      <list-index column="comment_order"/>
      <one-to-many class="Comment"/>
    </list>

    <list name="chapters" inverse="true" cascade="all-delete-orphan">
      <key column="book_id" not-null="true" foreign-key="chapter_book_fk"/>
      <list-index column="chapter_order"/>
      <one-to-many class="Chapter"/>
    </list>

    <bag name="authors" cascade="all">
      <key column="book_id" foreign-key="book_author_fk" />
      <one-to-many class="Author"/>
    </bag>

    <bag name="bookmarks" cascade="all-delete-orphan" inverse="true">
      <key column="book_id" foreign-key="bookmark_book_fk" not-null="true"/>
      <one-to-many class="Bookmark"/>
    </bag>

    <bag name="appendixes" table="book_appendix" inverse="true" cascade="save-update">
      <key column="book_id"/>
      <many-to-many class="Appendix" column="appendix_id" unique="true"/>
    </bag>
  </class>

  <class name="Comment" table="comment">
    <id name="id">
      <generator class="native"/>
    </id>
    <property name="body"/>
  </class>
  <class name="Author" table="author">
    <id name="id">
      <generator class="native"/>
    </id>
    <property name="name"/>
  </class>

  <class name="Bookmark" table="bookmark">
    <id name="id">
      <generator class="native"/>
    </id>
    <property name="name"/>
    <property name="pageNumber"/>
    <many-to-one name="book" class="Book" column="book_id"/>
  </class>

  <class name="Chapter" table="chapter">
    <id name="id">
      <generator class="native"/>
    </id>
    <property name="name"/>
    <many-to-one name="book" column="book_id" />
  </class>

  <class name="Appendix" table="appendix">
    <id name="id">
      <generator class="native"/>
    </id>
    <property name="name"/>
    <join table="book_appendix" optional="true">
      <key column="appendix_id" unique="true" not-null="true"/>
      <many-to-one name="book" column="book_id" />
    </join>
  </class>
</hibernate-mapping>